<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Special Offer</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --accent:#35A35C;
  --danger:#FF5E3A;
}

*{margin:0;padding:0;box-sizing:border-box}

html,body{
  height:100%;
  width:100%;
  overflow:hidden;
  font-family:Poppins,sans-serif;
  background:#f4f6f8;
}

.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
  transition:.4s ease;
}

.overlay.show{
  opacity:1;
  pointer-events:auto;
}

.popup{
  background:#fff;
  border-radius:18px;
  max-width:360px;
  width:92%;
  padding:28px;
  box-shadow:0 20px 40px rgba(0,0,0,.2);
  transform:scale(.9);
  transition:.4s ease;
}

.overlay.show .popup{transform:scale(1)}

h2{
  font-size:20px;
  font-weight:700;
  text-align:center;
  margin-bottom:16px;
}

.pricing{
  background:#f8f9fa;
  border-radius:14px;
  padding:20px;
  margin-bottom:20px;
}

.row{
  display:flex;
  justify-content:space-between;
  margin-bottom:8px;
  font-size:14px;
}

.old{
  color:#999;
  text-decoration:line-through;
}

.new{
  font-size:22px;
  font-weight:700;
  color:var(--accent);
}

.timer{
  display:flex;
  justify-content:center;
  gap:12px;
  margin-bottom:20px;
}

.time-box{
  background:#fff3f0;
  border:1px solid #ffd6ce;
  border-radius:10px;
  min-width:70px;
  padding:10px;
  text-align:center;
}

.time-box span{
  display:block;
  font-size:18px;
  font-weight:700;
  color:var(--danger);
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:999px;
  background:var(--danger);
  color:#fff;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="overlay" id="overlay">
  <div class="popup">
    <h2>{{PLAN_TITLE}}</h2>

    <div class="pricing">
      <div class="row">
        <span>Original price</span>
        <span class="old">$<span id="anchor">0</span></span>
      </div>
      <div class="row">
        <span>Your price</span>
        <span class="new">$<span id="price">0</span></span>
      </div>
      <div class="row">
        <span>Per unit</span>
        <span>$<span id="unit">0.00</span></span>
      </div>
    </div>

    <div class="timer">
      <div class="time-box">
        <span id="m">00</span>Min
      </div>
      <div class="time-box">
        <span id="s">00</span>Sec
      </div>
    </div>

    <button id="cta">Get Discount</button>
  </div>
</div>

<script>
/* ===== BACKEND CONTRACT (ROBUST) ===== */
const AFFILIATE_LINK = "{{AFFILIATE_LINK}}";

const ANCHOR_PRICE  = Number("{{ANCHOR_PRICE}}") || 0;
const YOUR_PRICE    = Number("{{YOUR_PRICE}}") || 0;
const OFFER_MINUTES = Number("{{OFFER_MINUTES}}") || 5;

/* ===== ELEMENTS ===== */
const overlay  = document.getElementById('overlay');
const anchorEl = document.getElementById('anchor');
const priceEl  = document.getElementById('price');
const unitEl   = document.getElementById('unit');
const m        = document.getElementById('m');
const s        = document.getElementById('s');
const btn      = document.getElementById('cta');

/* ===== STATE ===== */
let time = OFFER_MINUTES * 60;
let clicked = false;
let timerInterval = null;

/* ===== SHOW POPUP ===== */
document.addEventListener('DOMContentLoaded', () => {
  overlay.classList.add('show');
});

/* ===== INIT VALUES ===== */
anchorEl.textContent = ANCHOR_PRICE;
priceEl.textContent  = YOUR_PRICE;
unitEl.textContent   = YOUR_PRICE ? (YOUR_PRICE / 6).toFixed(2) : '0.00';

/* ===== TIMER ===== */
function startTimer(){
  if(timerInterval) clearInterval(timerInterval);

  timerInterval = setInterval(() => {
    if(time <= 0){
      btn.textContent = 'Expired';
      btn.style.opacity = 0.6;
      btn.onclick = null;
      clearInterval(timerInterval);
      return;
    }
    m.textContent = String(Math.floor(time / 60)).padStart(2,'0');
    s.textContent = String(time % 60).padStart(2,'0');
    time--;
  },1000);
}
startTimer();

/* ===== CTA (TRACKER SAFE) ===== */
btn.onclick = () => {
  if(clicked) return;
  clicked = true;

  if (typeof window.runTrackerRedirect === "function") {
    window.runTrackerRedirect(AFFILIATE_LINK);
  } else {
    window.location.href = AFFILIATE_LINK;
  }
};
</script>

</body>
</html>
